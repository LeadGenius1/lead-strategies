generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String             @id @default(uuid())
  email                   String             @unique
  passwordHash            String             @map("password_hash")
  name                    String?
  company                 String?
  tier                    Int                @default(1)
  stripeCustomerId        String?            @map("stripe_customer_id")
  stripeSubscriptionId    String?            @map("stripe_subscription_id")
  subscriptionStatus      String?            @default("trial") @map("subscription_status")
  trialEndsAt             DateTime?          @map("trial_ends_at")
  createdAt               DateTime           @default(now()) @map("created_at")
  updatedAt               DateTime           @updatedAt @map("updated_at")
  lastLoginAt             DateTime?          @map("last_login_at")
  google_id               String?            @unique
  microsoft_id            String?            @unique
  linkedin_id             String?            @unique
  auth_provider           String?            @default("email")
  profile_picture         String?
  email_verified          Boolean?           @default(false)
  email_verified_at       DateTime?
  metadata                Json?
  is_admin                Boolean?           @default(false)
  subscription_tier       String?            @default("free") @db.VarChar(50)
  trial_start_date        DateTime?          @default(now()) @db.Timestamp(6)
  trial_end_date          DateTime?          @default(dbgenerated("(CURRENT_TIMESTAMP + '14 days'::interval)")) @db.Timestamp(6)
  subscription_start_date DateTime?          @db.Timestamp(6)
  subscription_end_date   DateTime?          @db.Timestamp(6)
  last_payment_date       DateTime?          @db.Timestamp(6)
  payment_reminder_sent   Boolean?           @default(false)
  plan_tier               String?            @default("free") @db.VarChar(50)
  avatar_url              String?
  total_earnings          Decimal            @default(0) @db.Decimal(12, 2)
  balance_available       Decimal            @default(0) @db.Decimal(12, 2)
  activities              Activity[]
  apiKeys                 ApiKey[]
  autoResponses           AutoResponse[]
  calls                   Call[]
  campaigns               Campaign[]
  cannedResponses         CannedResponse[]
  companies               Company[]
  contacts                Contact[]
  conversationNotes       ConversationNote[]
  conversations           Conversation[]
  deals                   Deal[]
  documents               Document[]
  emailTemplates          EmailTemplate[]
  leads                   Lead[]
  messages                Message[]
  teamMemberships         TeamMember[]
  videos                  Video[]
  websites                Website[]
  emailAccounts           UserEmailAccount[]
  emailPoolSubscription   EmailPoolSubscription?

  @@index([metadata], type: Gin)
  @@map("users")
}

model Lead {
  id              String         @id @default(uuid())
  userId          String         @map("user_id")
  email           String
  name            String?
  company         String?
  phone           String?
  title           String?
  website         String?
  linkedinUrl     String?        @map("linkedin_url")
  source          String?
  status          String         @default("new")
  score           Int?           @default(0)
  notes           String?
  tags            String[]       @default([])
  customFields    Json?          @map("custom_fields")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  lastContactedAt DateTime?      @map("last_contacted_at")
  campaignLeads   CampaignLead[]
  emailEvents     EmailEvent[]
  user            User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, email])
  @@map("leads")
}

model Campaign {
  id            String         @id @default(uuid())
  userId        String         @map("user_id")
  name          String
  description   String?
  type          String         @default("email")
  status        String         @default("draft")
  subject       String?
  fromName      String?        @map("from_name")
  fromEmail     String?        @map("from_email")
  replyTo       String?        @map("reply_to")
  templateId    String?        @map("template_id")
  htmlContent   String?        @map("html_content")
  textContent   String?        @map("text_content")
  scheduledAt   DateTime?      @map("scheduled_at")
  startedAt     DateTime?      @map("started_at")
  completedAt   DateTime?      @map("completed_at")
  totalLeads    Int            @default(0) @map("total_leads")
  sentCount     Int            @default(0) @map("sent_count")
  openCount     Int            @default(0) @map("open_count")
  clickCount    Int            @default(0) @map("click_count")
  replyCount    Int            @default(0) @map("reply_count")
  bounceCount   Int            @default(0) @map("bounce_count")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  campaignLeads CampaignLead[]
  template      EmailTemplate? @relation(fields: [templateId], references: [id])
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  emailEvents   EmailEvent[]

  @@map("campaigns")
}

model CampaignLead {
  id         String    @id @default(uuid())
  campaignId String    @map("campaign_id")
  leadId     String    @map("lead_id")
  status     String    @default("pending")
  sentAt     DateTime? @map("sent_at")
  openedAt   DateTime? @map("opened_at")
  clickedAt  DateTime? @map("clicked_at")
  repliedAt  DateTime? @map("replied_at")
  campaign   Campaign  @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  lead       Lead      @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@unique([campaignId, leadId])
  @@map("campaign_leads")
}

model EmailTemplate {
  id          String     @id @default(uuid())
  userId      String     @map("user_id")
  name        String
  subject     String?
  htmlContent String?    @map("html_content")
  textContent String?    @map("text_content")
  variables   String[]   @default([])
  isDefault   Boolean    @default(false) @map("is_default")
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  campaigns   Campaign[]
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("email_templates")
}

model EmailEvent {
  id         String   @id @default(uuid())
  campaignId String   @map("campaign_id")
  leadId     String   @map("lead_id")
  eventType  String
  eventData  Json?    @map("event_data")
  createdAt  DateTime @default(now()) @map("created_at")
  campaign   Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)
  lead       Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@map("email_events")
}

model Website {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  name        String
  domain      String?
  subdomain   String?  @unique
  pages       Json?    @default("[]")
  settings    Json?    @default("{}")
  theme       String?  @default("default")
  isPublished Boolean  @default(false) @map("is_published")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("websites")
}

model Video {
  id           String   @id @default(uuid())
  userId       String   @map("user_id")
  title        String
  description  String?
  filename     String?
  file_url     String?
  thumbnailUrl String?  @map("thumbnail_url")
  duration     Int?
  fileSize     Int?     @map("file_size")
  isMonetized  Boolean  @default(false) @map("is_monetized")
  view_count   Int      @default(0)
  earnings     Decimal  @default(0) @db.Decimal(10, 2)
  status       String   @default("processing")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("videos")
}

model ApiKey {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  name        String
  key         String    @unique
  permissions String[]  @default(["read"])
  lastUsedAt  DateTime? @map("last_used_at")
  expiresAt   DateTime? @map("expires_at")
  isActive    Boolean   @default(true) @map("is_active")
  createdAt   DateTime  @default(now()) @map("created_at")
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("api_keys")
}

model Conversation {
  id            String             @id @default(uuid())
  userId        String             @map("user_id")
  contactName   String?            @map("contact_name")
  contactEmail  String?            @map("contact_email")
  contactPhone  String?            @map("contact_phone")
  contactId     String?            @map("contact_id")
  channel       String
  channelId     String?            @map("channel_id")
  subject       String?
  status        String             @default("open")
  priority      String             @default("normal")
  assignedTo    String?            @map("assigned_to")
  tags          String[]           @default([])
  labels        String[]           @default([])
  messageCount  Int                @default(0) @map("message_count")
  unreadCount   Int                @default(0) @map("unread_count")
  createdAt     DateTime           @default(now()) @map("created_at")
  updatedAt     DateTime           @updatedAt @map("updated_at")
  lastMessageAt DateTime?          @map("last_message_at")
  closedAt      DateTime?          @map("closed_at")
  notes         ConversationNote[]
  user          User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages      Message[]

  @@index([userId, status])
  @@index([userId, channel])
  @@index([userId, lastMessageAt])
  @@map("conversations")
}

model Message {
  id               String       @id @default(uuid())
  conversationId   String       @map("conversation_id")
  userId           String       @map("user_id")
  content          String
  htmlContent      String?      @map("html_content")
  subject          String?
  channel          String
  channelMessageId String?      @map("channel_message_id")
  direction        String       @default("inbound")
  status           String       @default("sent")
  isRead           Boolean      @default(false) @map("is_read")
  attachments      Json?
  metadata         Json?
  createdAt        DateTime     @default(now()) @map("created_at")
  readAt           DateTime?    @map("read_at")
  conversation     Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user             User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([userId, createdAt])
  @@map("messages")
}

model CannedResponse {
  id           String         @id @default(uuid())
  userId       String         @map("user_id")
  name         String
  content      String
  htmlContent  String?        @map("html_content")
  subject      String?
  category     String?
  tags         String[]       @default([])
  channels     String[]       @default([])
  variables    String[]       @default([])
  useCount     Int            @default(0) @map("use_count")
  createdAt    DateTime       @default(now()) @map("created_at")
  updatedAt    DateTime       @updatedAt @map("updated_at")
  AutoResponse AutoResponse[]
  user         User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, category])
  @@index([userId, createdAt])
  @@map("canned_responses")
}

model AutoResponse {
  id               String          @id @default(uuid())
  userId           String          @map("user_id")
  name             String
  description      String?
  enabled          Boolean         @default(true)
  triggerType      String
  conditions       Json
  cannedResponseId String?         @map("canned_response_id")
  responseContent  String?         @map("response_content")
  responseSubject  String?         @map("response_subject")
  channels         String[]        @default([])
  priority         Int             @default(0)
  delaySeconds     Int             @default(0) @map("delay_seconds")
  maxPerDay        Int?            @map("max_per_day")
  maxPerContact    Int?            @map("max_per_contact")
  triggerCount     Int             @default(0) @map("trigger_count")
  lastTriggeredAt  DateTime?       @map("last_triggered_at")
  createdAt        DateTime        @default(now()) @map("created_at")
  updatedAt        DateTime        @updatedAt @map("updated_at")
  cannedResponse   CannedResponse? @relation(fields: [cannedResponseId], references: [id])
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, priority])
  @@map("auto_responses")
}

model ConversationNote {
  id             String       @id @default(uuid())
  conversationId String       @map("conversation_id")
  userId         String       @map("user_id")
  content        String
  isInternal     Boolean      @default(true) @map("is_internal")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @updatedAt @map("updated_at")
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([conversationId, createdAt])
  @@index([userId, createdAt])
  @@map("conversation_notes")
}

model SystemHealthMetric {
  id          String   @id @default(uuid())
  metricName  String   @map("metric_name")
  metricValue Decimal  @map("metric_value") @db.Decimal(15, 4)
  metricUnit  String?  @map("metric_unit")
  component   String
  severity    String   @default("normal")
  createdAt   DateTime @default(now()) @map("created_at")

  @@index([metricName, createdAt])
  @@index([severity])
  @@index([component, createdAt])
  @@map("system_health_metrics")
}

model DiagnosticReport {
  id              String          @id @default(uuid())
  alertId         String?         @map("alert_id")
  issueType       String          @map("issue_type")
  rootCause       String?         @map("root_cause")
  evidence        Json?
  aiAnalysis      String?         @map("ai_analysis")
  aiModel         String?         @map("ai_model")
  confidenceScore Decimal?        @map("confidence_score") @db.Decimal(3, 2)
  suggestedFix    String?         @map("suggested_fix")
  severity        String?
  affectedUsers   Int?            @default(0) @map("affected_users")
  createdAt       DateTime        @default(now()) @map("created_at")
  repairs         RepairHistory[]

  @@index([issueType])
  @@index([severity])
  @@index([createdAt])
  @@map("diagnostic_reports")
}

model RepairHistory {
  id                 String            @id @default(uuid())
  diagnosticId       String?           @map("diagnostic_id")
  repairType         String            @map("repair_type")
  fixApplied         String?           @map("fix_applied")
  fixCode            String?           @map("fix_code")
  success            Boolean
  timeToFixSeconds   Int?              @map("time_to_fix_seconds")
  verificationResult Json?             @map("verification_result")
  rollbackPlan       String?           @map("rollback_plan")
  createdAt          DateTime          @default(now()) @map("created_at")
  diagnostic         DiagnosticReport? @relation(fields: [diagnosticId], references: [id])

  @@index([success])
  @@index([repairType])
  @@index([createdAt])
  @@map("repair_history")
}

model LearningPattern {
  id                String    @id @default(uuid())
  patternHash       String    @unique @map("pattern_hash")
  symptoms          Json
  rootCause         String?   @map("root_cause")
  solution          String?
  successCount      Int       @default(0) @map("success_count")
  failureCount      Int       @default(0) @map("failure_count")
  avgFixTimeSeconds Int?      @map("avg_fix_time_seconds")
  autoFixEnabled    Boolean   @default(false) @map("auto_fix_enabled")
  lastAppliedAt     DateTime? @map("last_applied_at")
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@index([patternHash])
  @@index([autoFixEnabled])
  @@map("learning_patterns")
}

model Prediction {
  id              String    @id @default(uuid())
  predictionType  String    @map("prediction_type")
  predictedIssue  String?   @map("predicted_issue")
  predictedTime   DateTime? @map("predicted_time")
  confidence      Decimal?  @db.Decimal(3, 2)
  dataPoints      Json?     @map("data_points")
  proactiveAction String?   @map("proactive_action")
  actionTaken     Boolean   @default(false) @map("action_taken")
  outcome         String?
  createdAt       DateTime  @default(now()) @map("created_at")

  @@index([predictionType])
  @@index([predictedTime])
  @@map("predictions")
}

model SecurityIncident {
  id               String   @id @default(uuid())
  threatType       String   @map("threat_type")
  severity         String?
  sourceIp         String?  @map("source_ip")
  targetEndpoint   String?  @map("target_endpoint")
  payload          String?
  userId           String?  @map("user_id")
  mitigationAction String?  @map("mitigation_action")
  blocked          Boolean  @default(false)
  createdAt        DateTime @default(now()) @map("created_at")

  @@index([threatType])
  @@index([sourceIp])
  @@index([severity])
  @@index([createdAt])
  @@map("security_incidents")
}

model PerformanceMetric {
  id                  String   @id @default(uuid())
  metricType          String   @map("metric_type")
  endpoint            String?
  queryHash           String?  @map("query_hash")
  valueMs             Decimal? @map("value_ms") @db.Decimal(10, 2)
  percentile95        Decimal? @map("percentile_95") @db.Decimal(10, 2)
  percentile99        Decimal? @map("percentile_99") @db.Decimal(10, 2)
  sampleCount         Int?     @map("sample_count")
  optimizationApplied String?  @map("optimization_applied")
  improvementPercent  Decimal? @map("improvement_percent") @db.Decimal(5, 2)
  createdAt           DateTime @default(now()) @map("created_at")

  @@index([metricType])
  @@index([endpoint])
  @@map("performance_metrics")
}

model SystemAlert {
  id             String    @id @default(uuid())
  alertType      String    @map("alert_type")
  component      String?
  message        String?
  severity       String?
  thresholdValue Decimal?  @map("threshold_value") @db.Decimal(15, 4)
  actualValue    Decimal?  @map("actual_value") @db.Decimal(15, 4)
  acknowledged   Boolean   @default(false)
  acknowledgedBy String?   @map("acknowledged_by")
  resolved       Boolean   @default(false)
  resolvedAt     DateTime? @map("resolved_at")
  autoResolved   Boolean   @default(false) @map("auto_resolved")
  createdAt      DateTime  @default(now()) @map("created_at")

  @@index([resolved])
  @@index([severity])
  @@index([alertType])
  @@index([createdAt])
  @@map("system_alerts")
}

model AdminUser {
  id           String          @id @default(uuid())
  email        String          @unique
  passwordHash String          @map("password_hash")
  name         String
  role         String          @default("admin")
  permissions  String[]        @default([])
  mfaEnabled   Boolean         @default(false) @map("mfa_enabled")
  mfaSecret    String?         @map("mfa_secret")
  lastLoginAt  DateTime?       @map("last_login_at")
  lastLoginIp  String?         @map("last_login_ip")
  failedLogins Int             @default(0) @map("failed_logins")
  lockedUntil  DateTime?       @map("locked_until")
  createdBy    String?         @map("created_by")
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")
  auditLogs    AdminAuditLog[]

  @@map("admin_users")
}

model AdminAuditLog {
  id          String    @id @default(uuid())
  adminUserId String    @map("admin_user_id")
  action      String
  resource    String?
  resourceId  String?   @map("resource_id")
  details     Json?
  ipAddress   String?   @map("ip_address")
  userAgent   String?   @map("user_agent")
  createdAt   DateTime  @default(now()) @map("created_at")
  adminUser   AdminUser @relation(fields: [adminUserId], references: [id])

  @@index([adminUserId])
  @@index([action])
  @@index([createdAt])
  @@map("admin_audit_logs")
}

model AdminSession {
  id           String   @id @default(uuid())
  adminUserId  String   @map("admin_user_id")
  token        String   @unique
  ipAddress    String?  @map("ip_address")
  userAgent    String?  @map("user_agent")
  expiresAt    DateTime @map("expires_at")
  createdAt    DateTime @default(now()) @map("created_at")
  lastActiveAt DateTime @default(now()) @map("last_active_at")

  @@index([token])
  @@index([adminUserId])
  @@index([expiresAt])
  @@map("admin_sessions")
}

model Company {
  id             String     @id @default(uuid())
  userId         String     @map("user_id")
  name           String
  domain         String?
  industry       String?
  size           String?
  revenue        String?
  website        String?
  linkedinUrl    String?    @map("linkedin_url")
  phone          String?
  address        String?
  city           String?
  state          String?
  country        String?
  postalCode     String?    @map("postal_code")
  description    String?
  foundedYear    Int?       @map("founded_year")
  employeeCount  Int?       @map("employee_count")
  technologies   String[]   @default([])
  funding        String?
  socialProfiles Json?      @map("social_profiles")
  accountOwner   String?    @map("account_owner")
  accountTier    String?    @default("prospect") @map("account_tier")
  tags           String[]   @default([])
  customFields   Json?      @map("custom_fields")
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  activities     Activity[]
  user           User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  contacts       Contact[]
  deals          Deal[]

  @@index([userId])
  @@index([name])
  @@index([industry])
  @@index([accountTier])
  @@map("companies")
}

model Contact {
  id              String     @id @default(uuid())
  userId          String     @map("user_id")
  companyId       String?    @map("company_id")
  firstName       String     @map("first_name")
  lastName        String     @map("last_name")
  email           String
  phone           String?
  mobile          String?
  jobTitle        String?    @map("job_title")
  department      String?
  linkedinUrl     String?    @map("linkedin_url")
  twitterUrl      String?    @map("twitter_url")
  status          String     @default("active")
  leadScore       Int?       @default(0) @map("lead_score")
  lifecycle       String?    @default("lead")
  source          String?
  tags            String[]   @default([])
  customFields    Json?      @map("custom_fields")
  emailOptIn      Boolean    @default(true) @map("email_opt_in")
  phoneOptIn      Boolean    @default(true) @map("phone_opt_in")
  smsOptIn        Boolean    @default(false) @map("sms_opt_in")
  timezone        String?
  preferredTime   String?    @map("preferred_time")
  lastContactedAt DateTime?  @map("last_contacted_at")
  createdAt       DateTime   @default(now()) @map("created_at")
  updatedAt       DateTime   @updatedAt @map("updated_at")
  activities      Activity[]
  calls           Call[]
  company         Company?   @relation(fields: [companyId], references: [id])
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  deals           Deal[]     @relation("ContactDeals")

  @@unique([userId, email])
  @@index([userId])
  @@index([companyId])
  @@index([email])
  @@index([lifecycle])
  @@map("contacts")
}

model Deal {
  id            String     @id @default(uuid())
  userId        String     @map("user_id")
  companyId     String?    @map("company_id")
  name          String
  value         Decimal    @db.Decimal(15, 2)
  currency      String     @default("USD")
  stage         String     @default("lead")
  probability   Int?       @default(0)
  priority      String?    @default("medium")
  description   String?
  nextStep      String?    @map("next_step")
  expectedClose DateTime?  @map("expected_close")
  actualClose   DateTime?  @map("actual_close")
  lostReason    String?    @map("lost_reason")
  wonReason     String?    @map("won_reason")
  competitor    String?
  ownerId       String?    @map("owner_id")
  teamId        String?    @map("team_id")
  tags          String[]   @default([])
  customFields  Json?      @map("custom_fields")
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime   @updatedAt @map("updated_at")
  activities    Activity[]
  company       Company?   @relation(fields: [companyId], references: [id])
  user          User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  documents     Document[]
  contacts      Contact[]  @relation("ContactDeals")

  @@index([userId])
  @@index([companyId])
  @@index([stage])
  @@index([expectedClose])
  @@index([ownerId])
  @@map("deals")
}

model Activity {
  id          String    @id @default(uuid())
  userId      String    @map("user_id")
  contactId   String?   @map("contact_id")
  companyId   String?   @map("company_id")
  dealId      String?   @map("deal_id")
  type        String
  subject     String?
  description String?
  outcome     String?
  dueDate     DateTime? @map("due_date")
  completedAt DateTime? @map("completed_at")
  duration    Int?
  isCompleted Boolean   @default(false) @map("is_completed")
  reminderAt  DateTime? @map("reminder_at")
  assignedTo  String?   @map("assigned_to")
  priority    String?   @default("normal")
  metadata    Json?
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  company     Company?  @relation(fields: [companyId], references: [id])
  contact     Contact?  @relation(fields: [contactId], references: [id])
  deal        Deal?     @relation(fields: [dealId], references: [id])
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([contactId])
  @@index([dealId])
  @@index([type])
  @@index([dueDate])
  @@index([isCompleted])
  @@map("activities")
}

model Call {
  id                  String    @id @default(uuid())
  userId              String    @map("user_id")
  contactId           String?   @map("contact_id")
  direction           String
  status              String
  fromNumber          String    @map("from_number")
  toNumber            String    @map("to_number")
  duration            Int?
  startedAt           DateTime? @map("started_at")
  endedAt             DateTime? @map("ended_at")
  twilioSid           String?   @unique @map("twilio_sid")
  twilioStatus        String?   @map("twilio_status")
  twilioPrice         Decimal?  @map("twilio_price") @db.Decimal(10, 4)
  recordingUrl        String?   @map("recording_url")
  recordingSid        String?   @map("recording_sid")
  transcription       String?
  transcriptionStatus String?   @map("transcription_status")
  sentiment           String?
  keywords            String[]  @default([])
  summary             String?
  actionItems         String[]  @default([]) @map("action_items")
  coachingNotes       String?   @map("coaching_notes")
  notes               String?
  outcome             String?
  metadata            Json?
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  contact             Contact?  @relation(fields: [contactId], references: [id])
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([contactId])
  @@index([direction])
  @@index([status])
  @@index([createdAt])
  @@map("calls")
}

model Document {
  id              String    @id @default(uuid())
  userId          String    @map("user_id")
  dealId          String?   @map("deal_id")
  name            String
  type            String
  mimeType        String?   @map("mime_type")
  size            Int?
  url             String
  storageKey      String?   @map("storage_key")
  status          String    @default("draft")
  version         Int       @default(1)
  parentId        String?   @map("parent_id")
  signatureStatus String?   @map("signature_status")
  signatureId     String?   @map("signature_id")
  signedAt        DateTime? @map("signed_at")
  expiresAt       DateTime? @map("expires_at")
  viewCount       Int       @default(0) @map("view_count")
  lastViewedAt    DateTime? @map("last_viewed_at")
  downloadCount   Int       @default(0) @map("download_count")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")
  deal            Deal?     @relation(fields: [dealId], references: [id])
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([dealId])
  @@index([type])
  @@index([status])
  @@map("documents")
}

model Team {
  id          String       @id @default(uuid())
  name        String
  description String?
  ownerId     String       @map("owner_id")
  settings    Json?
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  members     TeamMember[]

  @@map("teams")
}

model TeamMember {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  teamId      String   @map("team_id")
  role        String   @default("member")
  permissions String[] @default([])
  quota       Decimal? @db.Decimal(15, 2)
  quotaPeriod String?  @map("quota_period")
  isActive    Boolean  @default(true) @map("is_active")
  joinedAt    DateTime @default(now()) @map("joined_at")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  team        Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, teamId])
  @@index([userId])
  @@index([teamId])
  @@map("team_members")
}

model Pipeline {
  id          String          @id @default(uuid())
  userId      String          @map("user_id")
  name        String
  description String?
  isDefault   Boolean         @default(false) @map("is_default")
  createdAt   DateTime        @default(now()) @map("created_at")
  updatedAt   DateTime        @updatedAt @map("updated_at")
  stages      PipelineStage[]

  @@index([userId])
  @@map("pipelines")
}

model PipelineStage {
  id          String   @id @default(uuid())
  pipelineId  String   @map("pipeline_id")
  name        String
  position    Int      @default(0)
  probability Int      @default(0)
  color       String?
  rottingDays Int?     @map("rotting_days")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  pipeline    Pipeline @relation(fields: [pipelineId], references: [id], onDelete: Cascade)

  @@index([pipelineId])
  @@index([position])
  @@map("pipeline_stages")
}

model Sequence {
  id             String         @id @default(uuid())
  userId         String         @map("user_id")
  name           String
  description    String?
  status         String         @default("draft")
  channels       String[]       @default([])
  timezone       String?
  sendingDays    String[]       @default(["mon", "tue", "wed", "thu", "fri"]) @map("sending_days")
  sendingStart   String?        @map("sending_start")
  sendingEnd     String?        @map("sending_end")
  enrolledCount  Int            @default(0) @map("enrolled_count")
  completedCount Int            @default(0) @map("completed_count")
  repliedCount   Int            @default(0) @map("replied_count")
  bouncedCount   Int            @default(0) @map("bounced_count")
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")
  steps          SequenceStep[]

  @@index([userId])
  @@index([status])
  @@map("sequences")
}

model SequenceStep {
  id         String   @id @default(uuid())
  sequenceId String   @map("sequence_id")
  position   Int      @default(0)
  channel    String
  delayDays  Int      @default(1) @map("delay_days")
  delayHours Int      @default(0) @map("delay_hours")
  subject    String?
  body       String?
  template   String?
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  sequence   Sequence @relation(fields: [sequenceId], references: [id], onDelete: Cascade)

  @@index([sequenceId])
  @@index([position])
  @@map("sequence_steps")
}

model domain_acquisition_logs {
  id                 String    @id
  domain_name        String
  registrar          String
  purchase_status    String
  setup_status       String
  domain_cost        Float
  workspace_cost     Float
  total_cost         Float
  purchased_at       DateTime?
  dns_configured_at  DateTime?
  workspace_setup_at DateTime?
  warmup_started_at  DateTime?
  activated_at       DateTime?
  last_error         String?
  retry_count        Int       @default(0)
  created_at         DateTime  @default(now())
  updated_at         DateTime

  @@index([purchase_status, setup_status])
}

model domain_mailboxes {
  id               String      @id
  domain_id        String
  email_address    String
  mailbox_password String?
  smtp_host        String?
  smtp_port        Int?
  imap_host        String?
  imap_port        Int?
  daily_send_limit Int         @default(75)
  daily_send_count Int         @default(0)
  status           String      @default("active")
  created_at       DateTime    @default(now())
  updated_at       DateTime
  domain_pool      domain_pool @relation(fields: [domain_id], references: [id], onDelete: Cascade)

  @@unique([domain_id, email_address])
  @@index([domain_id])
}

model domain_pool {
  id                  String             @id
  domain_name         String             @unique
  provider            String             @default("google_workspace")
  status              String             @default("warming")
  reputation_score    Int                @default(0)
  daily_send_limit    Int                @default(150)
  daily_send_count    Int                @default(0)
  warmup_started_at   DateTime?
  warmup_completed_at DateTime?
  last_used_at        DateTime?
  created_at          DateTime           @default(now())
  updated_at          DateTime
  domain_mailboxes    domain_mailboxes[]

  @@index([domain_name])
  @@index([status])
}

model email_reminders {
  id            String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id       String?   @db.VarChar(255)
  reminder_type String    @db.VarChar(50)
  sent_at       DateTime? @default(now()) @db.Timestamp(6)
  email_status  String?   @default("sent") @db.VarChar(50)
}

model email_verification_tokens {
  id         String    @id
  user_id    String
  token_hash String    @unique
  expires_at DateTime
  used_at    DateTime?
  created_at DateTime  @default(now())

  @@index([expires_at])
  @@index([token_hash])
  @@index([user_id])
}

model subscription_logs {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String?   @db.VarChar(255)
  event_type String    @db.VarChar(50)
  event_data Json?
  created_at DateTime? @default(now()) @db.Timestamp(6)
}

// ============================================
// USER EMAIL DELIVERY SYSTEM â€” TWO-TIER
// (Restored from checkpoint-login-working)
// ============================================

model UserEmailAccount {
  id                   String        @id @default(cuid())
  userId               String
  email                String
  displayName          String?
  provider             EmailProvider
  status               AccountStatus @default(WARMING)
  tier                 EmailTier     @default(FREE)
  accessToken          String?       @db.Text
  refreshToken         String?       @db.Text
  tokenExpiresAt       DateTime?
  scopes               String?
  smtpHost             String?
  smtpPort             Int?
  smtpUsername         String?
  smtpPassword         String?       @db.Text
  imapHost             String?
  imapPort             Int?
  poolSubscriptionId   String?
  poolRotationOrder    Int?
  dailyLimit           Int           @default(50)
  dailySentCount       Int           @default(0)
  dailySentResetAt     DateTime      @default(now())
  totalSent            Int           @default(0)
  bounceCount          Int           @default(0)
  bounceRate           Float         @default(0)
  spamComplaintCount   Int           @default(0)
  spamComplaintRate    Float         @default(0)
  reputationScore      Int           @default(100)
  lastHealthCheck      DateTime?
  lastSentAt           DateTime?
  warmupStartedAt      DateTime?
  warmupDailyLimit     Int           @default(5)
  warmupCurrentDay     Int           @default(0)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt
  user                 User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  poolSubscription     EmailPoolSubscription? @relation(fields: [poolSubscriptionId], references: [id])
  @@unique([userId, email])
  @@index([userId])
  @@index([status])
  @@index([provider])
  @@index([tier])
  @@index([poolSubscriptionId])
}

model EmailPoolSubscription {
  id                   String   @id @default(cuid())
  userId               String   @unique
  stripeCustomerId     String?
  stripeSubscriptionId String?
  stripePriceId        String?
  status               PoolSubscriptionStatus @default(PENDING)
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  cancelAtPeriodEnd    Boolean  @default(false)
  poolSize             Int      @default(4)
  totalDailyLimit      Int      @default(800)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  poolAccounts        UserEmailAccount[]
  @@index([stripeSubscriptionId])
  @@index([status])
}

enum EmailProvider {
  GMAIL
  OUTLOOK
  SMTP
  MANAGED_POOL
}

enum AccountStatus {
  ACTIVE
  WARMING
  PAUSED
  DISCONNECTED
  ERROR
}

enum EmailTier {
  FREE
  PRO
}

enum PoolSubscriptionStatus {
  PENDING
  ACTIVE
  PAST_DUE
  CANCELED
  EXPIRED
}
