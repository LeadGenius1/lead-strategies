[build]
builder = "NIXPACKS"

[deploy]
startCommand = "node scripts/start.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/api/health"
healthcheckTimeout = 300

[deploy.resources]
memoryLimit = "512Mi"
cpuLimit = "0.5"

[nixpacks.phases.setup]
nixPkgs = ["nodejs_20"]

[nixpacks.phases.install]
cmds = [
  "npm ci --legacy-peer-deps || npm install --legacy-peer-deps"
]

[nixpacks.phases.build]
cmds = ["npm run build"]
